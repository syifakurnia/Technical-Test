// Nama Tes: TC-004 : Find pets by status 'available'

// --- 1. Validasi Status Code 200 OK ---
pm.test("TC-004: Status code is 200 OK", function () {
    pm.response.to.have.status(200);
});

// --- 2. Validasi Struktur Respons ---
const responseJson = pm.response.json();
pm.test("TC-004: Response body is an Array", function () {
    // Memastikan body respons adalah array (daftar pet)
    pm.expect(responseJson).to.be.an('array');
});

// --- 3. Validasi Integritas Data (Semua Pet memiliki status 'available') ---
// Kita akan melakukan iterasi (loop) pada setiap pet yang dikembalikan.
if (pm.response.code === 200 && Array.isArray(responseJson)) {
    
    // Gunakan 'every' untuk memastikan SEMUA elemen memenuhi kondisi
    const allPetsAreAvailable = responseJson.every(pet => pet.status === "available");
    
    pm.test("TC-004: All returned pets have status 'available'", function () {
        pm.expect(allPetsAreAvailable).to.be.true;
    });

    pm.test("TC-004: Array is not empty (at least one pet found)", function () {
        // Asumsi selalu ada data di Petstore. Jika array kosong, tes ini gagal.
        pm.expect(responseJson.length).to.be.above(0);
    });
}
