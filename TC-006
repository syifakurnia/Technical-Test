// Nama Tes: TC-006 : Find pets by status 'sold'

// --- 1. Validasi Status Code 200 OK ---
pm.test("TC-006: Status code is 200 OK", function () {
    pm.response.to.have.status(200);
});

// --- 2. Validasi Struktur Respons ---
const responseJson = pm.response.json();
pm.test("TC-006: Response body is an Array", function () {
    // Memastikan body respons adalah array (daftar pet)
    pm.expect(responseJson).to.be.an('array');
});

// --- 3. Validasi Integritas Data (Semua Pet memiliki status 'sold') ---
// Kita akan melakukan iterasi (loop) pada setiap pet yang dikembalikan.
if (pm.response.code === 200 && Array.isArray(responseJson)) {
    
    // Gunakan 'every' untuk memastikan semua elemen memenuhi kondisi
    const allPetsAreSold = responseJson.every(pet => pet.status === "sold");
    
    pm.test("TC-006: All returned pets have status 'sold'", function () {
        pm.expect(allPetsAreSold).to.be.true;
    });

    pm.test("TC-006: Array is not empty (at least one pet found)", function () {
        // Asumsi selalu ada data di Petstore. Jika array kosong, tes ini gagal.
        pm.expect(responseJson.length).to.be.above(0);
    });
}
